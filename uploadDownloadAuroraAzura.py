import socket, base64, requests, json

TCP_IP = "10.255.255.254"
TCP_PORT = 2031

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((TCP_IP, TCP_PORT))

data = s.recv(1024)
s.close()

print("Raw received data:", data)

msg_size = int.from_bytes(data[0:2], byteorder='big')
src_size = data[2]
src = data[3:3+src_size].decode('utf-8')
msg = data[3+src_size:3+src_size+msg_size]

print(f"Source: {src}")
print(f"Message bytes: {msg}")

b64_msg = base64.b64encode(msg).decode('utf-8')

print("Base64 Nachricht:", b64_msg)


AZURA_URL = "http://10.255.255.254:2030/put_message"

msg_aurora = b'\xd1\xa0\x8a\x88\xc7\xcf\xd9\xd9\xcb\xcd\xcf\x88\x90\x8a\x88\xd1\xf6\xc4\x8a\xf6\x88\xd9\xc5\xdf\xd8\xc9\xcf\xf6\x88\x90\x8a\xf6\x88\xeb\xdf\xd8\xc5\xd8\xcb\x8a\xf9\xde\xcb\xde\xc3\xc5\xc4\xf6\x88\x86\xf6\xc4\x8a\xf6\x88\xce\xcf\xd9\xde\xc3\xc4\xcb\xde\xc3\xc5\xc4\xf6\x88\x90\x8a\xf6\x88\xeb\xd0\xdf\xd8\xcb\x8a\xf9\xde\xcb\xde\xc3\xc5\xc4\xf6\x88\x86\xf6\xc4\x8a\xf6\x88\xce\xcb\xde\xcb\xf6\x88\x90\x8a\xf6\x88\xec\xc5\xd8\xd9\xc9\xc2\xdf\xc4\xcd\xd9\xce\xcb\xde\xcf\xc4\x8a\x82\xed\xd8\xdf\xda\xda\xcf\x8a\x9b\x93\x98\x84\x9b\x9c\x92\x84\x9b\x9a\x9b\x84\x9c\x9c\x83\xf6\x88\x86\xf6\xc4\x8a\xf6\x88\xde\xd9\xf6\x88\x90\x8a\xf6\x88\x9f\x9a\x92\x9d\x9a\x9e\x9e\x9f\xf6\x88\xf6\xc4\xd7\xf6\xc4\x88\x86\xa0\x8a\x88\xd9\xc3\xcd\xc4\xcb\xde\xdf\xd8\xcf\x88\x90\x8a\x88\x93\x9c\x9e\x9b\xcb\xc9\x9f\x9b\x9a\x9f\x98\x9f\xcc\xc9\x9c\x9c\x92\x9f\x9f\xcc\x93\xc9\x93\xcb\x92\x9c\xce\xcb\x9c\xcb\x98\x9b\x99\x98\x9e\x9d\xc9\x9e\xcc\xcc\x99\x99\x9d\xcc\x9d\xce\x98\x93\xcb\xc8\x9e\x99\x98\xcb\x99\x92\x9e\x9c\x9c\xc9\x9e\xcc\x99\x88\xa0\xd7\xa0'

b64_msg = base64.b64encode(msg_aurora).decode('utf-8')

payload = {
    "sending_station": "Aurora Station",  
    "base64data": b64_msg
}

response = requests.post(AZURA_URL, data=json.dumps(payload), headers={"Content-Type": "application/json"})

print(response.status_code)
print(response.text)